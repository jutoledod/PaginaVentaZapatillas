<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SneakerStore - Zapatillas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Navegación completa y consistente -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-running"></i> SneakerStore
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navProductos">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navProductos">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="productos.html">Zapatillas</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="blogs.html">Blog</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="nosotros.html">Nosotros</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="contacto.html">Contacto</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="login.html">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link carrito-btn" href="carrito.html">
                            <i class="fas fa-shopping-cart"></i> (<span id="contador">0</span>)
                        </a>
                    </li>
                    <!-- ADMIN LINK - Solo aparece después de login admin -->
                    <li class="nav-item admin-link">
                        <a class="nav-link" href="admin/home.html">
                            <i class="fas fa-cog"></i> Admin
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Indicador de carga -->
    <div class="loading-indicator d-none" id="loadingProductos">
        <div class="container py-3">
            <div class="text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Cargando productos...</span>
                </div>
                <p class="mt-2 text-muted">Cargando productos...</p>
            </div>
        </div>
    </div>

    <!-- Contenido Principal -->
    <div class="container py-5">
        <!-- Breadcrumb para mejor navegación -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="index.html" style="color: #111;">
                        <i class="fas fa-home"></i> Inicio
                    </a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">Zapatillas</li>
            </ol>
        </nav>

        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 style="font-weight: 700;">TODAS LAS ZAPATILLAS</h1>
            <div class="productos-counter">
                <small class="text-muted">
                    <span id="productosEncontrados">0</span> productos encontrados
                </small>
            </div>
        </div>
        
        <!-- Filtros mejorados -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-filter"></i> Filtros
                    <button class="btn btn-sm btn-outline-secondary float-end" onclick="limpiarFiltros()">
                        <i class="fas fa-times"></i> Limpiar
                    </button>
                </h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">Marca</label>
                        <select class="form-select" id="filtroMarca" onchange="filtrarProductos()">
                            <option value="">Todas las marcas</option>
                            <option value="nike">Nike</option>
                            <option value="adidas">Adidas</option>
                            <option value="puma">Puma</option>
                            <option value="newbalance">New Balance</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Categoría</label>
                        <select class="form-select" id="filtroCategoria" onchange="filtrarProductos()">
                            <option value="">Todas las categorías</option>
                            <option value="running">Running</option>
                            <option value="casual">Casual</option>
                            <option value="basketball">Basketball</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Precio</label>
                        <select class="form-select" id="filtroPrecio" onchange="filtrarProductos()">
                            <option value="">Todos los precios</option>
                            <option value="0-70000">Hasta $70.000</option>
                            <option value="70000-100000">$70.000 - $100.000</option>
                            <option value="100000-150000">$100.000 - $150.000</option>
                            <option value="150000-999999">Más de $150.000</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Disponibilidad</label>
                        <select class="form-select" id="filtroStock" onchange="filtrarProductos()">
                            <option value="">Todos</option>
                            <option value="disponible">Disponible</option>
                            <option value="critico">Stock Crítico</option>
                            <option value="agotado">Agotado</option>
                        </select>
                    </div>
                </div>

                <!-- Búsqueda de texto -->
                <div class="row mt-3">
                    <div class="col-md-6">
                        <label class="form-label">Buscar producto</label>
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="fas fa-search"></i>
                            </span>
                            <input type="text" class="form-control" id="busquedaTexto" 
                                   placeholder="Buscar por nombre, marca o código..." 
                                   onkeyup="filtrarProductos()">
                            <button class="btn btn-outline-secondary" type="button" onclick="limpiarBusqueda()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Ordenar por</label>
                        <select class="form-select" id="ordenamiento" onchange="ordenarProductos()">
                            <option value="">Orden por defecto</option>
                            <option value="nombre-asc">Nombre A-Z</option>
                            <option value="nombre-desc">Nombre Z-A</option>
                            <option value="precio-asc">Precio menor a mayor</option>
                            <option value="precio-desc">Precio mayor a menor</option>
                            <option value="stock-desc">Mayor stock</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mensaje cuando no hay productos -->
        <div class="alert alert-info d-none" id="noProductos">
            <div class="text-center">
                <i class="fas fa-search fa-3x mb-3 text-muted"></i>
                <h4>No se encontraron productos</h4>
                <p class="mb-3">Intenta ajustar los filtros o buscar con otros términos</p>
                <button class="btn btn-primary" onclick="limpiarFiltros()">
                    <i class="fas fa-refresh"></i> Limpiar filtros
                </button>
            </div>
        </div>

        <!-- Lista de Productos -->
        <div class="row" id="productos-container">
            <!-- Se carga con JavaScript -->
        </div>

        <!-- Botón volver arriba -->
        <button class="btn btn-primary btn-scroll-top d-none" id="btnScrollTop" onclick="scrollToTop()">
            <i class="fas fa-chevron-up"></i>
        </button>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/productos.js"></script>
    <script src="js/carrito.js"></script>
    <script src="js/main.js"></script>
    
    <script>
        // Variables globales para filtros
        let productosOriginales = [];
        let productosFiltrados = [];

        // Inicialización mejorada
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Mostrar indicador de carga
                mostrarCarga(true);
                
                // Inicializar funciones básicas
                if (typeof cargarCarrito === 'function') {
                    cargarCarrito();
                }
                
                if (typeof verificarSesionAdmin === 'function') {
                    verificarSesionAdmin();
                }

                // Cargar productos con delay para simular carga
                setTimeout(() => {
                    cargarTodosLosProductos();
                    mostrarCarga(false);
                }, 300);

                // Inicializar scroll top button
                initScrollTopButton();

            } catch (error) {
                console.error('Error en inicialización:', error);
                mostrarError('Error al cargar la página');
                mostrarCarga(false);
            }
        });

        // Función de carga mejorada
        function cargarTodosLosProductos() {
            try {
                if (typeof productos === 'undefined' || !Array.isArray(productos)) {
                    throw new Error('Productos no disponibles');
                }

                productosOriginales = [...productos];
                productosFiltrados = [...productos];
                
                mostrarTodosLosProductos();
                actualizarContadorProductos();
                
            } catch (error) {
                console.error('Error al cargar productos:', error);
                mostrarErrorProductos();
            }
        }

        // Mostrar/ocultar indicador de carga
        function mostrarCarga(mostrar) {
            const loading = document.getElementById('loadingProductos');
            const container = document.getElementById('productos-container');
            
            if (loading) {
                loading.classList.toggle('d-none', !mostrar);
            }
            if (container) {
                container.style.opacity = mostrar ? '0.5' : '1';
            }
        }

        // Función de filtrado mejorada
        function filtrarProductos() {
            try {
                const marca = document.getElementById('filtroMarca')?.value || '';
                const categoria = document.getElementById('filtroCategoria')?.value || '';
                const precio = document.getElementById('filtroPrecio')?.value || '';
                const stock = document.getElementById('filtroStock')?.value || '';
                const busqueda = (document.getElementById('busquedaTexto')?.value || '').toLowerCase().trim();

                let productosTemp = [...productosOriginales];

                // Filtro por marca
                if (marca) {
                    productosTemp = productosTemp.filter(p => p.marca === marca);
                }

                // Filtro por categoría
                if (categoria) {
                    productosTemp = productosTemp.filter(p => p.categoria === categoria);
                }

                // Filtro por precio
                if (precio) {
                    const [min, max] = precio.split('-').map(Number);
                    productosTemp = productosTemp.filter(p => {
                        const precioProducto = p.precio || 0;
                        return precioProducto >= min && precioProducto <= max;
                    });
                }

                // Filtro por stock
                if (stock) {
                    productosTemp = productosTemp.filter(p => {
                        const stockProducto = p.stock || 0;
                        const stockCritico = p.stockCritico || 0;
                        
                        switch (stock) {
                            case 'disponible':
                                return stockProducto > stockCritico;
                            case 'critico':
                                return stockProducto > 0 && stockProducto <= stockCritico;
                            case 'agotado':
                                return stockProducto <= 0;
                            default:
                                return true;
                        }
                    });
                }

                // Filtro por búsqueda de texto
                if (busqueda) {
                    productosTemp = productosTemp.filter(p => {
                        const nombre = (p.nombre || '').toLowerCase();
                        const marca = (p.marca || '').toLowerCase();
                        const codigo = (p.codigo || '').toLowerCase();
                        const descripcion = (p.descripcion || '').toLowerCase();
                        
                        return nombre.includes(busqueda) || 
                               marca.includes(busqueda) || 
                               codigo.includes(busqueda) ||
                               descripcion.includes(busqueda);
                    });
                }

                productosFiltrados = productosTemp;
                aplicarOrdenamiento();
                
            } catch (error) {
                console.error('Error al filtrar productos:', error);
                mostrarError('Error al aplicar filtros');
            }
        }

        // Función de ordenamiento
        function ordenarProductos() {
            aplicarOrdenamiento();
        }

        function aplicarOrdenamiento() {
            try {
                const orden = document.getElementById('ordenamiento')?.value || '';
                let productosOrdenados = [...productosFiltrados];

                switch (orden) {
                    case 'nombre-asc':
                        productosOrdenados.sort((a, b) => (a.nombre || '').localeCompare(b.nombre || ''));
                        break;
                    case 'nombre-desc':
                        productosOrdenados.sort((a, b) => (b.nombre || '').localeCompare(a.nombre || ''));
                        break;
                    case 'precio-asc':
                        productosOrdenados.sort((a, b) => (a.precio || 0) - (b.precio || 0));
                        break;
                    case 'precio-desc':
                        productosOrdenados.sort((a, b) => (b.precio || 0) - (a.precio || 0));
                        break;
                    case 'stock-desc':
                        productosOrdenados.sort((a, b) => (b.stock || 0) - (a.stock || 0));
                        break;
                    default:
                        // Orden por defecto (por ID)
                        productosOrdenados.sort((a, b) => (a.id || 0) - (b.id || 0));
                        break;
                }

                mostrarProductos(productosOrdenados);
                actualizarContadorProductos();
                
            } catch (error) {
                console.error('Error al ordenar productos:', error);
            }
        }

        // Limpiar filtros
        function limpiarFiltros() {
            try {
                document.getElementById('filtroMarca').value = '';
                document.getElementById('filtroCategoria').value = '';
                document.getElementById('filtroPrecio').value = '';
                document.getElementById('filtroStock').value = '';
                document.getElementById('ordenamiento').value = '';
                limpiarBusqueda();
                
                productosFiltrados = [...productosOriginales];
                mostrarProductos(productosFiltrados);
                actualizarContadorProductos();
                
            } catch (error) {
                console.error('Error al limpiar filtros:', error);
            }
        }

        // Limpiar búsqueda
        function limpiarBusqueda() {
            const input = document.getElementById('busquedaTexto');
            if (input) {
                input.value = '';
                filtrarProductos();
            }
        }

        // Actualizar contador de productos
        function actualizarContadorProductos() {
            const contador = document.getElementById('productosEncontrados');
            const noProductos = document.getElementById('noProductos');
            
            if (contador) {
                contador.textContent = productosFiltrados.length;
            }
            
            if (noProductos) {
                noProductos.classList.toggle('d-none', productosFiltrados.length > 0);
            }
        }

        // Mostrar error de productos
        function mostrarErrorProductos() {
            const container = document.getElementById('productos-container');
            if (container) {
                container.innerHTML = `
                    <div class="col-12">
                        <div class="alert alert-danger text-center">
                            <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                            <h4>Error al cargar productos</h4>
                            <p>No se pudieron cargar los productos. Por favor, recarga la página.</p>
                            <button class="btn btn-danger" onclick="location.reload()">
                                <i class="fas fa-refresh"></i> Recargar página
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        // Función para mostrar error general
        function mostrarError(mensaje) {
            console.error('Error:', mensaje);
            // Puedes personalizar esto para mostrar en la UI
        }

        // Botón scroll to top
        function initScrollTopButton() {
            const btnScrollTop = document.getElementById('btnScrollTop');
            if (!btnScrollTop) return;

            window.addEventListener('scroll', function() {
                if (window.pageYOffset > 300) {
                    btnScrollTop.classList.remove('d-none');
                } else {
                    btnScrollTop.classList.add('d-none');
                }
            });
        }

        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
    </script>

    <style>
        .btn-scroll-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            border-radius: 50%;
            width: 50px;
            height: 50px;
        }

        .loading-indicator {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(2px);
        }

        .productos-counter {
            font-size: 0.9rem;
        }

        .input-group .btn {
            border-left: none;
        }

        .breadcrumb-item a {
            text-decoration: none;
        }

        .breadcrumb-item a:hover {
            text-decoration: underline;
        }
    </style>
</body>
</html>
