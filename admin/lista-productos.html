<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SneakerStore - Lista Productos</title>

  <!-- Guard de admin (demo) -->
  <script>
    (function () {
      try {
        if (localStorage.getItem('esAdmin') !== 'true') {
          window.location.replace('../login.html');
        }
      } catch (e) {
        window.location.replace('../login.html');
      }
    })();
  </script>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
  <link rel="stylesheet" href="../css/styles.css"/>
  <link rel="stylesheet" href="../css/admin.css"/>
</head>
<body>
  <!-- Navegación Admin -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="../index.html">
        <i class="fas fa-running"></i> SneakerStore Admin
      </a>
      <div class="navbar-nav ms-auto">
        <a class="nav-link" href="../index.html">
          <i class="fas fa-home"></i> Volver a Tienda
        </a>
      </div>
    </div>
  </nav>

  <!-- Layout Admin -->
  <div class="container-fluid mt-3">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-md-3 col-lg-2">
        <div class="admin-sidebar">
          <div class="list-group list-group-flush">
            <a href="home.html" class="list-group-item list-group-item-action">
              <i class="fas fa-home"></i> Dashboard
            </a>
            <a href="lista-productos.html" class="list-group-item list-group-item-action active">
              <i class="fas fa-shoe-prints"></i> Productos
            </a>
            <a href="lista-usuarios.html" class="list-group-item list-group-item-action">
              <i class="fas fa-users"></i> Usuarios
            </a>
          </div>
        </div>
      </div>

      <!-- Contenido Principal -->
      <div class="col-md-9 col-lg-10">
        <div class="admin-content">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Gestión de Productos</h1>
            <a href="nuevo-producto.html" class="btn btn-primary">
              <i class="fas fa-plus"></i> Nuevo Producto
            </a>
          </div>

          <!-- Tabla de Productos -->
          <div class="card">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-striped table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th>Código</th>
                      <th>Nombre</th>
                      <th>Marca</th>
                      <th>Precio</th>
                      <th>Stock</th>
                      <th>Categoría</th>
                      <th>Estado</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="tabla-productos">
                    <!-- Se carga con JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- /Tabla -->
        </div>
      </div>
      <!-- /Contenido Principal -->
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../js/productos.js"></script>
  <script>
    // Mostrar productos en tabla usando helpers de productos.js
    function mostrarTablaProductos() {
      const tbody = document.getElementById('tabla-productos');
      if (!tbody) return;

      const lista = Array.isArray(window.productos) ? window.productos : [];
      tbody.innerHTML = '';

      if (!lista.length) {
        tbody.innerHTML = `
          <tr>
            <td colspan="8" class="text-center text-muted">No hay productos cargados</td>
          </tr>
        `;
        return;
      }

      lista.forEach((p) => {
        const sc = Number.isFinite(p.stockCritico) ? p.stockCritico : 0;
        const enCritico = (p.stock || 0) <= sc;
        const stockClass = enCritico ? 'text-danger' : 'text-success';
        const estadoTexto = (p.stock || 0) <= 0 ? 'Sin stock' : (enCritico ? 'Stock Crítico' : 'Disponible');
        const estadoBadge = (p.stock || 0) <= 0 ? 'bg-secondary' : (enCritico ? 'bg-danger' : 'bg-success');

        // Helpers desde productos.js, con fallback simple
        const precioFmt = (typeof window.formatearPrecio === 'function') ? formatearPrecio(p.precio) : `$${p.precio}`;
        const marcaBadgeClass = (typeof window.getMarcaColor === 'function') ? getMarcaColor(p.marca) : 'bg-secondary';

        tbody.innerHTML += `
          <tr>
            <td><code>${p.codigo ?? '-'}</code></td>
            <td>${p.nombre ?? '-'}</td>
            <td><span class="badge ${marcaBadgeClass}">${String(p.marca || '').toUpperCase()}</span></td>
            <td>${precioFmt}</td>
            <td><span class="${stockClass} fw-bold">${p.stock ?? 0}</span></td>
            <td>${p.categoria ?? '-'}</td>
            <td><span class="badge ${estadoBadge}">${estadoTexto}</span></td>
            <td>
              <button class="btn btn-sm btn-outline-primary me-1" onclick="editarProducto(${Number(p.id)})" title="Editar">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger" onclick="eliminarProducto(${Number(p.id)})" title="Eliminar">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        `;
      });
    }

    // Funciones de administración (simuladas)
    function editarProducto(id) {
      alert(`Editar producto ID: ${id}`);
      // Aquí iría la lógica para editar (modal/otra página)
    }

    function eliminarProducto(id) {
      if (confirm('¿Estás seguro de eliminar este producto?')) {
        alert(`Producto ID: ${id} eliminado`);
        // Aquí iría la lógica para eliminar
      }
    }

    // Inicializar
    document.addEventListener('DOMContentLoaded', function () {
      mostrarTablaProductos();
    });
  </script>
</body>
</html>
